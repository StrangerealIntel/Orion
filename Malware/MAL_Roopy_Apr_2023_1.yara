rule MAL_Roopy_Apr_2023_1 : apt roopy stealer
{
    meta:
        description = "Detect Roopy stealer"
        author = "Arkbird_SOLG"
        date = "2023-04-24"
        reference = "https://securelist.com/tomiris-called-they-want-their-turla-malware-back/109552/"
        hash1 = "0dfbc54a5a88f27e52807873c20872bc6bf92b822de90545492081c4e4f96778"
        hash2 = "9c086f242120be7a9e57e06b75d8ef6f051a77c6339deaeb574e80ee69590111"
        hash3 = "a4ea3462bd5aedccc783d18d24589018c257b2a6e092164c01de067a8e3cd649"
        tlp = "Clear"
        adversary = "-"
    strings:
        $s1 = { 31 c0 68 [2] 40 00 55 68 [2] 41 00 64 ff 30 64 89 20 80 7d f4 00 74 4f 8d 85 ?? ef ff ff e8 [2] 00 00 6a 00 b8 [2] 43 00 89 85 ?? ef ff ff 8b 45 f8 89 85 ?? ef ff ff b8 [2] 43 00 89 85 ?? ef ff ff 8d 95 ?? ef ff ff b9 02 00 00 00 8d 85 ?? ef ff ff e8 [2] 00 00 8b 85 ?? ef ff ff 30 d2 e8 [2] ff ff c6 45 d4 00 8d 85 c4 ef ff ff ba [2] 43 00 e8 [2] 00 00 31 c0 68 [2] 40 00 55 68 [2] 41 00 64 ff 30 64 89 20 8d 55 e0 8b 45 fc e8 ?? fd ff }
        $s2 = { c7 45 f4 00 00 00 00 8d 45 f0 50 8d 45 f4 50 53 8b 45 dc ff 70 10 6a 00 b8 [2] 44 00 50 6a 00 8b 45 fc 85 c0 75 05 b8 [2] 44 00 50 89 f0 e8 47 ff ff ff 88 c2 8b 45 dc e8 2d 04 00 00 50 e8 [2] fe ff 8b 55 dc 89 42 04 8b 45 dc 83 78 04 00 0f 94 c3 eb 40 8d 45 }
        $s3 = { 50 ff 75 e8 e8 [2] ff ff 89 45 ec 6a 00 ff b5 c0 ef ff ff 6a 00 6a 00 b8 [2] 43 00 50 8d 95 ?? ef ff ff b8 [2] 43 00 e8 [2] ff ff 8b 85 ?? ef ff ff 85 c0 75 05 b8 [2] 44 00 50 8d 95 ?? ef ff ff b8 [2] 43 00 e8 [2] ff ff 8b 85 ?? ef ff ff 85 c0 75 05 b8 [2] 44 00 50 ff 75 ec e8 [2] ff ff 89 45 e4 68 00 00 00 20 8d 95 ?? ef ff ff b8 [2] 43 00 e8 [2] ff ff 8b 85 }
    condition:
       uint16(0) == 0x5A4D and filesize > 90KB and all of ($s*) 
}
