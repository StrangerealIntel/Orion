rule MAL_TunnusSched_Apr_2023_1 : apt tunnussched backdoor
{
    meta:
        description = "Detect TunnusSched/QUIETCANARY backdoor"
        author = "Arkbird_SOLG"
        date = "2023-04-24"
        reference = "https://securelist.com/tomiris-called-they-want-their-turla-malware-back/109552/"
        hash1 = "0fc624aa9656a8bc21731bfc47fd7780da38a7e8ad7baf1529ccd70a5bb07852"
        hash2 = "3f94b20cb7f4ff55207660649ebbb02679c991fe03efbcb0bd3840fc7f0bd527"
        hash3 = "29314f3cd73b81eda7bd90c66f659235e6bb900e499c9cc7057d10a9083a0b94"
        tlp = "Clear"
        adversary = "-"
    strings:
        $s1 = { 70 14 0a 72 ?? 00 00 70 0b 72 ?? 00 00 70 0c 73 ?? 00 00 06 28 ?? 00 00 0a 08 07 06 73 ?? 00 00 06 0d 16 13 08 2b 23 09 6f ?? 00 00 06 2d 20 11 08 17 33 06 16 28 ?? 00 00 0a 20 e0 93 04 00 28 ?? 00 00 0a 11 08 17 58 13 08 11 08 18 31 d8 73 ?? 00 00 06 13 04 11 04 6f ?? 00 00 06 73 ?? 00 00 06 13 05 11 04 11 05 73 ?? 00 00 06 13 06 09 11 06 11 04 73 ?? 00 00 06 13 07 11 07 6f ?? 00 00 06 28 ?? 00 00 0a 11 05 }
        $s2 = { 06 0a 7e ?? 00 00 0a 0b 03 6f ?? 00 00 0a 0c 2b 62 12 02 28 ?? 00 00 0a 0d 1d 8d ?? 00 00 01 25 16 07 a2 25 17 72 ?? 01 00 70 a2 25 18 09 6f ?? 00 00 06 13 04 12 04 28 ?? 00 00 0a a2 25 19 72 ?? 01 00 70 a2 25 1a 09 6f ?? 00 00 06 6f ?? 00 00 0a 13 04 12 04 28 ?? 00 00 0a a2 25 1b 72 ?? 01 00 70 a2 25 1c 09 6f ?? 00 00 06 a2 28 ?? 00 00 0a 0b 12 02 28 ?? 00 00 0a 2d 95 de 0e 12 02 fe 16 05 00 00 1b 6f ?? 00 00 0a dc 07 7e ?? 00 00 0a 28 ?? 00 00 0a 2c 06 }
        $s3 = { 03 28 ?? 00 00 0a 2d 07 72 [2] 00 70 2b 15 72 [2] 00 70 03 28 ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 0a 0a de [2] 72 [2] 00 70 }
    condition:
       uint16(0) == 0x5A4D and filesize > 8KB and all of ($s*) 
}
