rule MAL_Reptile_Aug_2023_1 : opensource reptile X64
{
   meta:
        description = "Detect the opensource rootkit Reptile (used by APT41 group)"
        author = "Arkbird_SOLG"
        reference = "https://asec.ahnlab.com/en/55785/"
        date = "2023-08-05"
        hash1 = "15e4e936b2f47eb3fa2455b7c22b2714bebe9f8c01b24bbf7cb5f9559999d292"
        hash2 = "7ce7b914bd434f8a45db1cb3ec783237a5485b7abcee4df06275ea274e095295"
        hash2 = "d182239d408da23306ea6b0f5f129ef401565a4d7ab4fe33506f8ac0a08d37ba"
        tlp = "Clear"
        adversary = "APT41"
   strings:
       $s1 = { 48 85 d2 75 26 4c 8b 0f 31 c0 48 63 d0 46 8a 04 0a 44 3a 04 16 75 14 ff c0 45 84 c0 75 ec 31 c0 48 85 c9 48 89 4f 08 0f 95 c0 c3 31 c0 c3 31 f6 41 b9 [3] 00 41 b8 0d 00 00 00 44 89 c8 31 d2 29 f0 89 c7 41 f7 f0 81 f7 [4] 88 d1 d3 c7 31 be [4] 48 83 c6 04 48 81 fe }
       $s2 = "parasite_blob" ascii
       $s3 = { 48 83 ec 28 48 8d 75 e0 48 c7 c7 ?? 00 00 ?? 48 8d 44 24 0f 48 c7 45 e8 00 00 00 00 48 83 e0 f0 c7 00 5f 5f 64 6f c7 40 04 5f 73 79 73 c7 40 08 5f 69 6e 69 c7 40 0c 74 5f 6d 6f c7 40 10 64 75 6c 65 c7 40 14 00 00 00 00 48 89 45 e0 e8 [3] 00 48 8b 45 e8 48 85 c0 74 }
   condition:
        uint32(0) == 0x464C457F and filesize > 40KB and all of ($s*)
}
