rule MAL_Telemiris_Apr_2023_1 : apt telemiris backdoor
{
    meta:
        description = "Detect Telemiris backdoor"
        author = "Arkbird_SOLG"
        date = "2023-04-24"
        reference = "https://securelist.com/tomiris-called-they-want-their-turla-malware-back/109552/"
        hash1 = "fd7fe71185a70f281545a815fce9837453450bb29031954dd2301fe4da99250d"
        hash2 = "df75defc7bde078faefcb2c1c32f16c141337a1583bd0bc14f6d93c135d34289"
        hash3 = "4b9811f1f8176ec9f2ee647a4c2f171854f296fbc18e47cc08eb82357a6eeec7"
        tlp = "Clear"
        adversary = "-"
    strings:
        $s1 = { 48 83 ec 20 83 b9 78 50 00 00 01 48 8b d9 74 40 48 8d 15 cf 65 02 00 e8 d2 af ff ff 48 8d 8b 78 30 00 00 48 8b d0 e8 33 00 00 00 85 c0 75 17 48 8d 0d c8 }
        $s2 = { 50 59 5a 00 6f 0d 0d 0a 00 1a ca ?? 00 00 00 00 00 78 9c 8d 91 bd 4b c5 30 10 c0 fb fd fa f5 7c 82 b8 77 d4 c1 b7 0b 22 ba 39 88 0e 6f 0b c2 51 9b f0 5e 20 d7 86 b4 55 ea 9f e3 d6 7f a9 ab 93 b3 9b 93 39 5a 17 27 03 f9 91 bb 1c bf cb 91 0f e7 cf f2 ec be b1 fb eb ce 82 3b }
        $s3 = { 40 00 21 df ?? 00 08 ab 40 00 18 9c 00 01 62 63 72 79 70 74 6f 67 72 61 70 68 79 5c 68 61 7a 6d 61 74 5c 62 69 6e 64 69 6e 67 73 5c 5f 72 75 73 74 2e 70 79 64 }
    condition:
       uint16(0) == 0x5A4D and filesize > 900KB and all of ($s*) 
}
