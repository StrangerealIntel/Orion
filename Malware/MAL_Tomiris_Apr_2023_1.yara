rule MAL_Tomiris_Apr_2023_1 : apt tomiris downloader dotnet
{
    meta:
        description = "Detect .NET version of downloader Tomiris"
        author = "Arkbird_SOLG"
        date = "2023-04-24"
        reference = "https://securelist.com/tomiris-called-they-want-their-turla-malware-back/109552/"
        hash1 = "358411a3b4a327805d629612b1b64357efe5389e56ddae9128ababbc8a2357a1"
        hash2 = "65da1696d36da254779a028b881a1890b0b037e7eee8ea0a9446c8bb0729c1cf"
        tlp = "Clear"
        adversary = "-"
    strings:
        $s1 = { 06 16 28 02 00 00 06 26 28 0f 00 00 0a 0a 72 01 00 00 70 0b 72 3f 00 00 70 0c 72 7d 00 00 70 0d 72 bb 00 00 70 13 04 1a 13 05 72 f3 00 00 70 13 06 72 09 01 00 70 13 07 72 1f 01 00 70 13 08 72 35 01 00 70 13 09 1f 13 8d 13 00 00 01 25 16 72 4d 01 00 70 a2 25 17 28 10 00 00 0a a2 25 18 72 79 01 00 70 a2 25 19 28 10 00 00 0a a2 25 1a 72 9f 01 00 70 a2 25 1b 28 10 00 00 0a a2 25 1c 72 d1 01 00 70 }
        $s2 = { 72 b4 04 00 70 28 1b 00 00 0a 26 73 17 00 00 0a 13 0f 11 05 28 16 00 00 0a 72 e6 04 00 70 11 09 28 14 00 00 0a 11 0a 28 15 00 00 0a 11 0f 09 72 e6 04 00 70 11 06 28 14 00 00 0a 6f 18 00 00 0a 11 0f 08 72 e6 04 00 70 11 08 28 14 00 00 0a 6f 18 00 00 0a 11 0f 07 72 e6 04 00 70 11 07 28 14 00 00 0a 6f 18 00 00 0a 11 0f 11 04 72 1a 05 00 70 6f 18 00 00 0a 11 05 28 16 00 00 0a 72 5c 05 00 70 1d 8d 13 00 00 01 25 16 72 6c 05 00 70 a2 25 17 11 06 a2 25 18 72 a8 05 00 70 a2 25 19 11 07 a2 25 1a 72 f6 05 00 70 a2 25 1b 11 09 a2 25 1c 72 3c 06 00 70 a2 28 11 00 00 0a 28 1a 00 00 }
    condition:
       uint16(0) == 0x5A4D and filesize > 5KB and all of ($s*) 
}
