rule MAL_Reptile_Aug_2023_2 : opensource reptile X64
{
   meta:
        description = "Detect the opensource rootkit Reptile (used by APT41 group)"
        author = "Arkbird_SOLG"
        reference = "https://asec.ahnlab.com/en/55785/"
        date = "2023-08-05"
        hash1 = "99ffc0099277bef59a37a4cfcf4cdd71df13ad33d1c7bf943dc87f803e75dd2c"
        hash2 = "cbe9107185c8e42140dbd1294d8c20849134dd122cc64348f1bfcc90401379ec"
        tlp = "Clear"
        adversary = "APT41"
   strings:
       $s1 = { 55 48 c7 c6 [4] 41 b8 0d 00 00 00 48 89 e5 41 54 53 bb [2] 06 00 48 83 ec 10 89 d8 31 d2 89 df 41 f7 f0 81 f7 [4] 83 eb 04 88 d1 d3 c7 31 3e 48 83 c6 04 83 fb 03 75 df 48 83 ec 20 48 8d 5d e0 48 c7 c7 [4] 48 8d 44 24 0f 48 89 de 48 83 e0 f0 c7 00 73 79 73 5f c7 40 04 69 6e 69 74 c7 40 08 }
       $s2 = "parasite_blob" ascii
       $s3 = { 65 48 8b 04 25 [4] 48 c7 c2 [2] 00 ?? 4c 8b a0 48 ?? ff ff eb 03 48 ff c2 80 3a 00 75 f8 48 c7 c0 [4] be [2] 06 00 48 c7 c7 [2] 00 ?? 48 25 00 f0 ff ff 65 48 8b 1c 25 [4] 48 89 83 48 ?? ff ff ff d1 48 83 f8 01 4c 89 a3 48 ?? ff ff 19 }
   condition:
        uint32(0) == 0x464C457F and filesize > 40KB and all of ($s*)
}
